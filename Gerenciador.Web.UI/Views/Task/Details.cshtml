@model Gerenciador.Domain.Task

@{
    ViewBag.Title = "Details";
}

<section class="content invoice">
    <!-- title row -->
    <div class="row">
        <div class="col-xs-12">
            <h2 class="page-header">
                <i class="fa fa-file-text-o"> @Model.Name</i> <span class="label label-warning">Pending</span>
                <small class="pull-right">Data de Hoje: @DateTime.Now </small>
            </h2>
            <div class="progress progress">
                <div id="test" class="progress-bar progress-bar-primary" role="progressbar" aria-valuenow="@Model.Progress" aria-valuemin="0" aria-valuemax="100" style="width: @Model.Progress%">
                    <span id="progressLegend"><strong>@Model.Progress% Completo</strong></span>
                </div>
            </div>
        </div><!-- /.col -->
    </div>
    <!-- info row -->
    <div class="row invoice-info">
        <div class="col-sm-4 invoice-col">
            <strong>Início </strong><br />
            Criado: <strong>@Model.CreatedAt</strong><br>
            Iniciado: <strong>@DateTime.Now</strong><br />
            <strong>Término</strong><br>
            Expectativa inicial: <strong>xxxxx</strong> <br>
            Data de término: <strong>xxxx</strong><br>
            Variação: <strong>+/- 3 dias</strong> 
        </div><!-- /.col -->

        <div class="col-sm-4 invoice-col">
            <div class="box box-solid bg-light-blue-gradient">
                <div class="box-body no-padding">
                    <!--The calendar -->
                    <div id="calendar" style="width: 100%"></div>
                </div><!-- /.box-body -->
            </div>            
        </div><!-- /.col -->

        <div class="col-sm-4 invoice-col">
            <strong>Ações </strong><br />
            <a class="btn btn-app">
                <i class="fa fa-edit"></i> Conteúdo
            </a>
            <button class="btn btn-app" data-toggle="modal" data-target="#modalUpdateProgress">
                <i class="fa fa-play"></i> Progresso
            </button>
            <a class="btn btn-app">
                <i class="fa fa-arrow-circle-o-right"></i> Sub-tarefa
            </a>
            <a class="btn btn-app">
                <i class="fa fa-bullhorn"></i> Comentário
            </a>
        </div><!-- /.col -->
    </div><!-- /.row -->    

    <br />

    <div class="row">
        <div class="col-md-12">
            <blockquote>@Html.DisplayFor(x => x.Description)</blockquote> 
        </div>
    </div>

    <!-- Table row -->
    <h2>Micro tarefas</h2>
    <div class="row">
        <div class="col-xs-12 table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Name</th>
                        <th>Data de início</th>
                        <th>Data fim</th>
                        <th>Terminada?</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>3dc22228-851e-4611-b33d-d96f4f9c53aa</td>
                        <td>Sub tarefa 1</td>
                        <td>13/10/2014</td>
                        <td>16/10/2014</td>
                        <td>Sim</td>
                    </tr>
                    <tr>
                        <td>3dc22228-851e-4611-b33d-d96f4f9c53aa</td>
                        <td>Sub tarefa 2</td>
                        <td>13/10/2014</td>
                        <td>16/10/2014</td>
                        <td>Sim</td>
                    </tr>
                    <tr>
                        <td>3dc22228-851e-4611-b33d-d96f4f9c53aa</td>
                        <td>Sub tarefa 3</td>
                        <td>13/10/2014</td>
                        <td>16/10/2014</td>
                        <td>Não</td>
                    </tr>
                    <tr>
                        <td>3dc22228-851e-4611-b33d-d96f4f9c53aa</td>
                        <td>Sub tarefa 4</td>
                        <td>13/10/2014</td>
                        <td>16/10/2014</td>
                        <td>Não</td>
                    </tr>
                </tbody>
            </table>
        </div><!-- /.col -->
    </div><!-- /.row -->

    <div class="row">
        <!-- accepted payments column -->
        <div class="col-xs-6">
            <p class="lead">Comentários:</p>
            <p class="text-muted well well-sm no-shadow" style="margin-top: 10px;">
                Etsy doostang zoodles disqus groupon greplin oooj voxy zoodles, weebly ning heekya handango imeem plugg dopplr jibjab, movity jajah plickers sifteo edmodo ifttt zimbra.
            </p>
            <p class="text-muted well well-sm no-shadow" style="margin-top: 10px;">
                Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
                tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
                quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
            </p>
            <p class="text-muted well well-sm no-shadow" style="margin-top: 10px;">
                Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
                tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
                quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
            </p>
        </div><!-- /.col -->
        <div class="col-xs-6">
            @Html.Partial("~/Views/Task/_TaskTimelineWidget.cshtml")
        </div><!-- /.col -->
    </div><!-- /.row -->

    <!-- this row will not appear when printing -->
    <div class="row no-print">
        <div class="col-xs-12">
            <button class="btn btn-default pull-right" onclick="window.print();"><i class="fa fa-print"></i> Print</button>
            <button class="btn btn-success pull-right"><i class="fa fa-credit-card"></i> Edit</button>
            <button class="btn btn-primary pull-right" style="margin-right: 5px;"><i class="fa fa-download"></i> Generate PDF</button>
        </div>
    </div>
</section>

<p>
    @Html.ActionLink("Edit", "Edit", new { id=Model.Id }) |
    @Html.ActionLink("Back to List", "Index")
</p>

<!-- Modal -->
<div class="modal fade" id="modalUpdateProgress" tabindex="-1" role="dialog" aria-labelledby="modalUpdateProgressLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fechar</span></button>
                <h4 class="modal-title" id="modalUpdateProgressLabel">Progresso</h4>
            </div>
            <div class="modal-body">
               <input id="progressUpdaterSlider" type="text" value="" class="slider form-control" data-slider-min="0" data-slider-max="100" data-slider-step="5" data-slider-value="@Model.Progress" data-slider-orientation="horizontal" data-slider-selection="before" data-slider-tooltip="show" data-slider-id="blue">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
                <button id="btnProgressSave" type="button" class="btn btn-primary">Salvar</button>
            </div>
        </div>
    </div>
</div>



@section scripts{
    <script type="text/javascript">
        $("#calendar").datepicker();
        $('.slider').slider();

        $(document).ready(function () {
            $(".modal-footer").on("click", "#btnProgressSave", function () {
                var _valueToUpdate = $('#progressUpdaterSlider')[0].value
                var _projectId = '@(Model.ProjectId)';
                var _id = '@(Model.Id)';
                var posting = $.post('/Task/UpdateProgress', { projectId: _projectId, id: _id, newValue: _valueToUpdate });
                posting.done(function (data) {
                    var dataToUpdate = data + '%';
                    console.log(dataToUpdate);
                    $('#modalUpdateProgress').modal('hide')
                    $('#test').width(dataToUpdate);
                    setInterval(function () { $("#progressLegend").html($('<strong/>').append(dataToUpdate + ' Completo')); }, 300);
                });                
            });
        });
    </script>    
}
